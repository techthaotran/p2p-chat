{"ast":null,"code":"import _toConsumableArray from \"D:\\\\FW\\\\p2p-chat\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"D:\\\\FW\\\\p2p-chat\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"D:\\\\FW\\\\p2p-chat\\\\src\\\\App.js\";\nimport React, { useCallback, useState } from \"react\";\nimport styles from \"./App.module.css\";\nimport { JoinDialog } from \"./JoinDialog\";\nimport { CreateDialog } from \"./CreateDialog\";\nexport default function App() {\n  var _this = this;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      peer = _useState2[0],\n      setPeer = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      log = _useState4[0],\n      setLog = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      message = _useState6[0],\n      setMessage = _useState6[1];\n\n  var onConnect = useCallback(function (p) {\n    setPeer(p);\n    p.on(\"data\", function (data) {\n      setLog(function (log) {\n        return [{\n          local: false,\n          action: \"message\",\n          value: data\n        }].concat(_toConsumableArray(log));\n      });\n    });\n    p.on(\"close\", function (data) {\n      setLog(function (log) {\n        return [{\n          local: false,\n          action: \"disconnect\"\n        }].concat(_toConsumableArray(log));\n      });\n    });\n    p.on(\"error\", function (data) {\n      setLog(function (log) {\n        return [{\n          local: false,\n          action: \"error\",\n          value: data\n        }].concat(_toConsumableArray(log));\n      });\n    });\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 7\n    }\n  }, \"Serverless P2P Chat\"), peer ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.chatLog,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 29,\n      columnNumber: 11\n    }\n  }, log.map(function (_ref, idx) {\n    var local = _ref.local,\n        action = _ref.action,\n        value = _ref.value;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: idx,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 31,\n        columnNumber: 15\n      }\n    }, action === \"message\" && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: local ? styles.usernameLocal : styles.usernameRemote,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 34,\n        columnNumber: 21\n      }\n    }, local ? \"You\" : \"Stranger\", \":\", \" \"), value), action === \"disconnect\" && /*#__PURE__*/React.createElement(\"span\", {\n      className: styles.usernameRemote,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 19\n      }\n    }, \"Stranger has disconnected.\"), action === \"error\" && /*#__PURE__*/React.createElement(\"span\", {\n      className: styles.debugInfo,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 19\n      }\n    }, value.toString()));\n  })), /*#__PURE__*/React.createElement(\"form\", {\n    className: styles.chatForm,\n    onSubmit: function onSubmit(e) {\n      e.preventDefault();\n\n      try {\n        peer.send(message);\n        setLog([{\n          local: true,\n          action: \"message\",\n          value: message\n        }].concat(_toConsumableArray(log)));\n        setMessage(\"\");\n      } catch (err) {\n        setLog(function (log) {\n          return [{\n            local: false,\n            action: \"error\",\n            value: \"Error: cannot send message\"\n          }].concat(_toConsumableArray(log));\n        });\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    autoFocus: true,\n    className: styles.chatInput,\n    type: \"text\",\n    value: message,\n    onChange: function onChange(evt) {\n      return setMessage(evt.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 13\n    }\n  }, \"Send\"))) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(CreateDialog, {\n    onConnect: onConnect,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(JoinDialog, {\n    onConnect: onConnect,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 11\n    }\n  })));\n}","map":{"version":3,"names":["React","useCallback","useState","styles","JoinDialog","CreateDialog","App","peer","setPeer","log","setLog","message","setMessage","onConnect","p","on","data","local","action","value","chatLog","map","idx","usernameLocal","usernameRemote","debugInfo","toString","chatForm","e","preventDefault","send","err","chatInput","evt","target"],"sources":["D:/FW/p2p-chat/src/App.js"],"sourcesContent":["import React, { useCallback, useState } from \"react\";\r\nimport styles from \"./App.module.css\";\r\nimport { JoinDialog } from \"./JoinDialog\";\r\nimport { CreateDialog } from \"./CreateDialog\";\r\n\r\nexport default function App() {\r\n  const [peer, setPeer] = useState(null);\r\n  const [log, setLog] = useState([]);\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  const onConnect = useCallback(p => {\r\n    setPeer(p);\r\n    p.on(\"data\", data => {\r\n      setLog(log => [{ local: false, action: \"message\", value: data }, ...log]);\r\n    });\r\n    p.on(\"close\", data => {\r\n      setLog(log => [{ local: false, action: \"disconnect\" }, ...log]);\r\n    });\r\n    p.on(\"error\", data => {\r\n      setLog(log => [{ local: false, action: \"error\", value: data }, ...log]);\r\n    });\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <h1>Serverless P2P Chat</h1>\r\n      {peer ? (\r\n        <>\r\n          <div className={styles.chatLog}>\r\n            {log.map(({ local, action, value }, idx) => (\r\n              <div key={idx}>\r\n                {action === \"message\" && (\r\n                  <>\r\n                    <span\r\n                      className={\r\n                        local ? styles.usernameLocal : styles.usernameRemote\r\n                      }\r\n                    >\r\n                      {local ? \"You\" : \"Stranger\"}:{\" \"}\r\n                    </span>\r\n                    {value}\r\n                  </>\r\n                )}\r\n                {action === \"disconnect\" && (\r\n                  <span className={styles.usernameRemote}>\r\n                    Stranger has disconnected.\r\n                  </span>\r\n                )}\r\n                {action === \"error\" && (\r\n                  <span className={styles.debugInfo}>{value.toString()}</span>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n          <form\r\n            className={styles.chatForm}\r\n            onSubmit={e => {\r\n              e.preventDefault();\r\n              try {\r\n                peer.send(message);\r\n                setLog([\r\n                  { local: true, action: \"message\", value: message },\r\n                  ...log\r\n                ]);\r\n                setMessage(\"\");\r\n              } catch (err) {\r\n                setLog(log => [\r\n                  {\r\n                    local: false,\r\n                    action: \"error\",\r\n                    value: \"Error: cannot send message\"\r\n                  },\r\n                  ...log\r\n                ]);\r\n              }\r\n            }}\r\n          >\r\n            <input\r\n              autoFocus\r\n              className={styles.chatInput}\r\n              type=\"text\"\r\n              value={message}\r\n              onChange={evt => setMessage(evt.target.value)}\r\n            />\r\n            <button>Send</button>\r\n          </form>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <CreateDialog onConnect={onConnect} />\r\n          <JoinDialog onConnect={onConnect} />\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}